<div class="container mt-4">

  <!-- TITLE -->
  <h3 class="mb-4 text-center">Transaction Statement</h3>

  <!-- FILTER FORM -->
  <div class="card shadow-sm p-4 mb-4">
    <form
      [formGroup]="historyForm"
      (ngSubmit)="fetchTransactions()"
      class="row g-3 align-items-end">

      <div class="col-md-4">
        <label class="form-label">Account Number</label>
        <input
          type="text"
          class="form-control"
          placeholder="Enter Account Number"
          formControlName="accountNumber">
      </div>

      <div class="col-md-3">
        <label class="form-label">From Date</label>
        <input
          type="datetime-local"
          class="form-control"
          formControlName="fromDate">
      </div>

      <div class="col-md-3">
        <label class="form-label">To Date</label>
        <input
          type="datetime-local"
          class="form-control"
          formControlName="toDate">
      </div>

      <div class="col-md-2">
        <button
          class="btn btn-primary w-100"
          type="submit"
          [disabled]="loading">
          {{ loading ? 'Loading...' : 'Fetch' }}
        </button>
      </div>

    </form>
  </div>

  <!-- ERROR MESSAGE -->
  <div *ngIf="errorMessage" class="alert alert-danger text-center">
    {{ errorMessage }}
  </div>

  <!-- LOADING SPINNER -->
  <div *ngIf="loading" class="text-center my-4">
    <div class="spinner-border text-primary"></div>
  </div>

  <!-- TRANSACTION TABLE -->
  <div *ngIf="transactions.length">

    <div class="d-flex justify-content-between align-items-center mb-2">
      <h5 class="mb-0">Transaction List</h5>

      <div>
        <button
          class="btn btn-danger btn-sm me-2"
          (click)="exportPDF()">
          Export PDF
        </button>

        <button
          class="btn btn-success btn-sm"
          (click)="exportCSV()">
          Export CSV
        </button>
      </div>
    </div>

    <table class="table table-bordered table-striped mt-2">
      <thead class="table-dark">
        <tr>
          <th>Type</th>
          <th>Amount</th>
          <th>Balance After</th>
          <th>Date</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let t of transactions">
          <td>
            <span
              class="badge"
              [ngClass]="{
                'bg-success': t.transactionType === 'CREDIT',
                'bg-danger': t.transactionType === 'DEBIT'
              }">
              {{ t.transactionType }}
            </span>
          </td>

          <td>₹ {{ t.amount }}</td>
          <td>₹ {{ t.balanceAfterTransaction }}</td>
          <td>{{ t.transactionDate | date:'short' }}</td>
        </tr>
      </tbody>
    </table>

  </div>

  <!-- EMPTY STATE -->
  <div *ngIf="!loading && !transactions.length && !errorMessage"
       class="text-center text-muted mt-4">
    No transactions found. Enter details and click Fetch.
  </div>

</div>
